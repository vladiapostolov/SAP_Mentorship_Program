{% extends "layout.html" %}
{% set title = "Inventory Statistics" %}
{% block content %}
<div class="dashboard-header">
    <h1>üìä Inventory Statistics</h1>
    <p>Analyze inventory changes and trends</p>
</div>

<!-- Time Period Filter -->
<div class="card">
    <div style="display: flex; gap: 10px; align-items: center;">
        <strong>Time Period:</strong>
        <a href="{{ url_for('statistics.statistics', days=7) }}" 
           class="btn {% if days == 7 %}btn-primary{% else %}btn-secondary{% endif %}" 
           style="padding: 8px 16px;">Last 7 Days</a>
        <a href="{{ url_for('statistics.statistics', days=30) }}" 
           class="btn {% if days == 30 %}btn-primary{% else %}btn-secondary{% endif %}" 
           style="padding: 8px 16px;">Last 30 Days</a>
        <a href="{{ url_for('statistics.statistics', days=90) }}" 
           class="btn {% if days == 90 %}btn-primary{% else %}btn-secondary{% endif %}" 
           style="padding: 8px 16px;">Last 90 Days</a>
    </div>
</div>

<!-- Summary Stats -->
{% if summary %}
<div class="stats-grid">
    <div class="stat-card">
        <h3>{{ summary.total_transactions or 0 }}</h3>
        <p>Total Transactions</p>
    </div>
    <div class="stat-card success">
        <h3>+{{ summary.total_added or 0 }}</h3>
        <p>Items Added</p>
    </div>
    <div class="stat-card danger">
        <h3>-{{ summary.total_removed or 0 }}</h3>
        <p>Items Removed</p>
    </div>
    <div class="stat-card warning">
        <h3>{{ summary.active_items or 0 }}</h3>
        <p>Active Items</p>
    </div>
</div>
{% endif %}

<!-- Top Added Items -->
<div class="card">
    <h2>üìà Top 10 Most Added Items (Last {{ days }} Days)</h2>
    {% if top_added %}
    <table>
        <thead>
            <tr>
                <th>Item Name</th>
                <th>Type</th>
                <th>SKU</th>
                <th>Total Added</th>
                <th>Add Count</th>
            </tr>
        </thead>
        <tbody>
            {% for item in top_added %}
            <tr>
                <td><strong>{{ item.name }}</strong></td>
                <td><span class="badge">{{ item.type }}</span></td>
                <td><code>{{ item.sku }}</code></td>
                <td><span style="color: #28a745; font-weight: bold;">+{{ item.total_added }}</span></td>
                <td>{{ item.add_count }} times</td>
            </tr>
            {% endfor %}
        </tbody>
    </table>
    {% else %}
    <p style="text-align: center; color: #888;">No items added in this period</p>
    {% endif %}
</div>

<!-- Top Removed Items -->
<div class="card">
    <h2>üìâ Top 10 Most Removed Items (Last {{ days }} Days)</h2>
    {% if top_removed %}
    <table>
        <thead>
            <tr>
                <th>Item Name</th>
                <th>Type</th>
                <th>SKU</th>
                <th>Total Removed</th>
                <th>Remove Count</th>
            </tr>
        </thead>
        <tbody>
            {% for item in top_removed %}
            <tr>
                <td><strong>{{ item.name }}</strong></td>
                <td><span class="badge">{{ item.type }}</span></td>
                <td><code>{{ item.sku }}</code></td>
                <td><span style="color: #dc3545; font-weight: bold;">-{{ item.total_removed }}</span></td>
                <td>{{ item.remove_count }} times</td>
            </tr>
            {% endfor %}
        </tbody>
    </table>
    {% else %}
    <p style="text-align: center; color: #888;">No items removed in this period</p>
    {% endif %}
</div>

<!-- Activity by Item Type -->
<div class="card">
    <h2>üè∑Ô∏è Activity by Item Type</h2>
    {% if type_activity %}
    <table>
        <thead>
            <tr>
                <th>Type</th>
                <th>Items</th>
                <th>Added</th>
                <th>Removed</th>
                <th>Net Change</th>
                <th>Total Events</th>
            </tr>
        </thead>
        <tbody>
            {% for type in type_activity %}
            <tr>
                <td><span class="badge">{{ type.type }}</span></td>
                <td>{{ type.item_count }}</td>
                <td style="color: #28a745;">+{{ type.total_added }}</td>
                <td style="color: #dc3545;">-{{ type.total_removed }}</td>
                <td>
                    {% set net = type.total_added - type.total_removed %}
                    <strong style="color: {% if net > 0 %}#28a745{% elif net < 0 %}#dc3545{% else %}#888{% endif %}">
                        {% if net > 0 %}+{% endif %}{{ net }}
                    </strong>
                </td>
                <td>{{ type.total_events }}</td>
            </tr>
            {% endfor %}
        </tbody>
    </table>
    {% else %}
    <p style="text-align: center; color: #888;">No activity in this period</p>
    {% endif %}
</div>

<!-- All Items with Changes -->
<div class="card">
    <h2>üì¶ All Items with Quantity Changes (Last {{ days }} Days)</h2>
    {% if quantity_changes %}
    <table>
        <thead>
            <tr>
                <th>Item Name</th>
                <th>Type</th>
                <th>Current Qty</th>
                <th>Added</th>
                <th>Removed</th>
                <th>Net Change</th>
                <th>Events</th>
            </tr>
        </thead>
        <tbody>
            {% for item in quantity_changes %}
            <tr>
                <td><strong>{{ item.name }}</strong></td>
                <td><span class="badge">{{ item.type }}</span></td>
                <td>{{ item.current_quantity }}</td>
                <td style="color: #28a745;">+{{ item.total_added }}</td>
                <td style="color: #dc3545;">-{{ item.total_removed }}</td>
                <td>
                    {% set net = item.total_added - item.total_removed %}
                    <strong style="color: {% if net > 0 %}#28a745{% elif net < 0 %}#dc3545{% else %}#888{% endif %}">
                        {% if net > 0 %}+{% endif %}{{ net }}
                    </strong>
                </td>
                <td>{{ item.total_events }}</td>
            </tr>
            {% endfor %}
        </tbody>
    </table>
    {% else %}
    <p style="text-align: center; color: #888;">No quantity changes in this period</p>
    {% endif %}
</div>

<!-- Daily Activity -->
<div class="card">
    <h2>üìÖ Daily Activity Summary</h2>
    {% if daily_activity %}
    <table>
        <thead>
            <tr>
                <th>Date</th>
                <th>Added</th>
                <th>Removed</th>
                <th>Net Change</th>
                <th>Transactions</th>
            </tr>
        </thead>
        <tbody>
            {% for day in daily_activity %}
            <tr>
                <td><strong>{{ day.date }}</strong></td>
                <td style="color: #28a745;">+{{ day.added }}</td>
                <td style="color: #dc3545;">-{{ day.removed }}</td>
                <td>
                    {% set net = day.added - day.removed %}
                    <strong style="color: {% if net > 0 %}#28a745{% elif net < 0 %}#dc3545{% else %}#888{% endif %}">
                        {% if net > 0 %}+{% endif %}{{ net }}
                    </strong>
                </td>
                <td>{{ day.total_transactions }}</td>
            </tr>
            {% endfor %}
        </tbody>
    </table>
    {% else %}
    <p style="text-align: center; color: #888;">No daily activity in this period</p>
    {% endif %}
</div>

<div class="card">
    <a href="{{ url_for('dashboard.dashboard') }}" class="btn btn-secondary">‚Üê Back to Dashboard</a>
</div>

<style>
.stats-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
    gap: 20px;
    margin-bottom: 20px;
}

.stat-card {
    background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
    color: white;
    padding: 25px;
    border-radius: 10px;
    text-align: center;
    box-shadow: 0 4px 6px rgba(0,0,0,0.1);
}

.stat-card.success {
    background: linear-gradient(135deg, #28a745 0%, #20c997 100%);
}

.stat-card.danger {
    background: linear-gradient(135deg, #dc3545 0%, #c82333 100%);
}

.stat-card.warning {
    background: linear-gradient(135deg, #ffc107 0%, #e0a800 100%);
}

.stat-card h3 {
    margin: 0 0 10px 0;
    font-size: 2.5em;
}

.stat-card p {
    margin: 0;
    opacity: 0.9;
    font-size: 1em;
}

.badge {
    display: inline-block;
    padding: 4px 8px;
    border-radius: 4px;
    background: #e9ecef;
    color: #495057;
    font-size: 0.85em;
    font-weight: 600;
}

code {
    background: #f8f9fa;
    padding: 2px 6px;
    border-radius: 3px;
    font-family: 'Courier New', monospace;
    font-size: 0.9em;
}
</style>
{% endblock %}
