{% extends "layout.html" %}
{% set title = "Item Details" %}
{% block content %}
<div class="dashboard-header">
    <h1>ğŸ“¦ Item Details: {{ item.name }}</h1>
    <p>Manage stock and view history for this item</p>
</div>

<div class="card">
    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 1rem;">
        <div>
            <h4>ğŸ“¦ Basic Info</h4>
            <p><strong>Name:</strong> {{ item.name }}</p>
            <p><strong>Type:</strong> {{ item.type }}</p>
            <p><strong>Description:</strong> {{ item.description or "â€”" }}</p>
            <p><strong>QR Code:</strong> {{ item.qr_code }}</p>
        </div>
        <div>
            <h4>ğŸ“Š Stock Status</h4>
            <p><strong>Current Quantity:</strong> {{ item.quantity }}</p>
            <p><strong>Last Added (IN):</strong> {{ item.last_in_ts or "Never" }}</p>
            <p><strong>Last Removed (OUT):</strong> {{ item.last_out_ts or "Never" }}</p>
        </div>
        <div>
            <h4>ğŸ“ˆ Last Event</h4>
            <p><strong>Action:</strong> {{ item.last_event_action or "â€”" }}</p>
            <p><strong>Quantity:</strong> {{ item.last_event_qty or "â€”" }}</p>
            <p><strong>By:</strong> {{ item.last_event_by or "â€”" }}</p>
            <p><strong>At:</strong> {{ item.last_event_ts or "â€”" }}</p>
        </div>
    </div>
</div>

<div class="card">
    <h3>âš¡ Stock Actions</h3>
    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 1rem;">
        {% if current_user.role == 'ADMIN' %}
        <form method="post" action="{{ url_for('scan.stock_action', action='ADD', item_id=item.id) }}">
            <h4>â• Add Stock</h4>
            <div class="form-group">
                <label>Quantity to Add</label>
                <input name="quantity" type="number" min="1" value="1" required>
            </div>
            <div class="form-group">
                <label>Note (optional)</label>
                <input name="note" placeholder="Add a note">
            </div>
            <button type="submit" class="btn btn-primary">ğŸ“¥ Add Stock</button>
        </form>
        {% endif %}

        <form method="post" action="{{ url_for('scan.stock_action', action='REMOVE', item_id=item.id) }}">
            <h4>{% if current_user.role == 'ADMIN' %}â– Remove Stock{% else %}ğŸ›’ Order Item{% endif %}</h4>
            <div class="form-group">
                <label>Quantity to {% if current_user.role == 'ADMIN' %}Remove{% else %}Order{% endif %}</label>
                <input name="quantity" type="number" min="1" value="1" required>
            </div>
            <div class="form-group">
                <label>Note (optional)</label>
                <input name="note" placeholder="Add a note">
            </div>
            <button type="submit" class="btn {% if current_user.role == 'ADMIN' %}btn-secondary{% else %}btn-primary{% endif %}">{% if current_user.role == 'ADMIN' %}ğŸ“¤ Remove Stock{% else %}ğŸ›’ Order Item{% endif %}</button>
        </form>
    </div>
</div>

<div class="inventory-table">
    <h3>ğŸ“œ Recent History</h3>
    <table>
        <thead>
            <tr>
                <th>ğŸ•’ Time</th>
                <th>âš¡ Action</th>
                <th>ğŸ”¢ Quantity</th>
                <th>ğŸ‘¤ User</th>
                <th>ğŸ“ Note</th>
            </tr>
        </thead>
        <tbody>
            {% for e in events %}
            <tr>
                <td>{{ e.timestamp_created }}</td>
                <td>{{ e.action }}</td>
                <td>{{ e.quantity }}</td>
                <td>{{ e.user_name }}</td>
                <td>{{ e.note or "â€”" }}</td>
            </tr>
            {% endfor %}
        </tbody>
    </table>
</div>
{% endblock %}
